version: '3.8'

services:
  bot:
    build: .
    container_name: hypergrid_bot
    restart: unless-stopped
    command: [ "python3", "binance_bot.py", "--testnet" ]
    volumes:
      - ./logs:/app/logs
      - ./config.json:/app/config.json
      - ./state.json:/app/state.json
      - ./.env:/app/.env
    environment:
      - BINANCE_API_KEY=${BINANCE_API_KEY}
      - BINANCE_API_SECRET=${BINANCE_API_SECRET}
    healthcheck:
      test: [ "CMD", "pgrep", "-f", "binance_bot.py" ]
      interval: 30s
      timeout: 10s
      retries: 3

  api:
    build: .
    container_name: hypergrid_api
    restart: always
    volumes:
      - ./logs:/app/logs
      - ./config.json:/app/config.json
      - ./state.json:/app/state.json
    environment:
      - BINANCE_API_KEY=${BINANCE_API_KEY}
      - BINANCE_API_SECRET=${BINANCE_API_SECRET}

  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    container_name: hypergrid_ui
    ports:
      - "80:80"
    depends_on:
      - api
